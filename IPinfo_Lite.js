/*
 * IPinfo Lite API for Quantumult X
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * [general]
 * geo_location_checker=https://api.ipinfo.io/lite/me?token=YOUR_TOKEN, https://cdn.jsdelivr.net/gh/lzyjianlai/qx-scripts@master/IPinfo_Lite.js
 */

var flags = new Map([
  ["AC","ğŸ‡¦ğŸ‡¨"],["AE","ğŸ‡¦ğŸ‡ª"],["AF","ğŸ‡¦ğŸ‡«"],["AL","ğŸ‡¦ğŸ‡±"],["AM","ğŸ‡¦ğŸ‡²"],["AR","ğŸ‡¦ğŸ‡·"],["AT","ğŸ‡¦ğŸ‡¹"],["AU","ğŸ‡¦ğŸ‡º"],
  ["AZ","ğŸ‡¦ğŸ‡¿"],["BA","ğŸ‡§ğŸ‡¦"],["BD","ğŸ‡§ğŸ‡©"],["BE","ğŸ‡§ğŸ‡ª"],["BG","ğŸ‡§ğŸ‡¬"],["BH","ğŸ‡§ğŸ‡­"],["BR","ğŸ‡§ğŸ‡·"],["BY","ğŸ‡§ğŸ‡¾"],
  ["CA","ğŸ‡¨ğŸ‡¦"],["CH","ğŸ‡¨ğŸ‡­"],["CL","ğŸ‡¨ğŸ‡±"],["CN","ğŸ‡¨ğŸ‡³"],["CO","ğŸ‡¨ğŸ‡´"],["CR","ğŸ‡¨ğŸ‡·"],["CY","ğŸ‡¨ğŸ‡¾"],["CZ","ğŸ‡¨ğŸ‡¿"],
  ["DE","ğŸ‡©ğŸ‡ª"],["DK","ğŸ‡©ğŸ‡°"],["DZ","ğŸ‡©ğŸ‡¿"],["EC","ğŸ‡ªğŸ‡¨"],["EE","ğŸ‡ªğŸ‡ª"],["EG","ğŸ‡ªğŸ‡¬"],["ES","ğŸ‡ªğŸ‡¸"],["FI","ğŸ‡«ğŸ‡®"],
  ["FR","ğŸ‡«ğŸ‡·"],["GB","ğŸ‡¬ğŸ‡§"],["GE","ğŸ‡¬ğŸ‡ª"],["GR","ğŸ‡¬ğŸ‡·"],["HK","ğŸ‡­ğŸ‡°"],["HR","ğŸ‡­ğŸ‡·"],["HU","ğŸ‡­ğŸ‡º"],["ID","ğŸ‡®ğŸ‡©"],
  ["IE","ğŸ‡®ğŸ‡ª"],["IL","ğŸ‡®ğŸ‡±"],["IN","ğŸ‡®ğŸ‡³"],["IQ","ğŸ‡®ğŸ‡¶"],["IR","ğŸ‡®ğŸ‡·"],["IS","ğŸ‡®ğŸ‡¸"],["IT","ğŸ‡®ğŸ‡¹"],["JO","ğŸ‡¯ğŸ‡´"],
  ["JP","ğŸ‡¯ğŸ‡µ"],["KE","ğŸ‡°ğŸ‡ª"],["KG","ğŸ‡°ğŸ‡¬"],["KH","ğŸ‡°ğŸ‡­"],["KR","ğŸ‡°ğŸ‡·"],["KW","ğŸ‡°ğŸ‡¼"],["KZ","ğŸ‡°ğŸ‡¿"],["LA","ğŸ‡±ğŸ‡¦"],
  ["LB","ğŸ‡±ğŸ‡§"],["LK","ğŸ‡±ğŸ‡°"],["LT","ğŸ‡±ğŸ‡¹"],["LU","ğŸ‡±ğŸ‡º"],["LV","ğŸ‡±ğŸ‡»"],["LY","ğŸ‡±ğŸ‡¾"],["MA","ğŸ‡²ğŸ‡¦"],["MD","ğŸ‡²ğŸ‡©"],
  ["MK","ğŸ‡²ğŸ‡°"],["MM","ğŸ‡²ğŸ‡²"],["MN","ğŸ‡²ğŸ‡³"],["MO","ğŸ‡²ğŸ‡´"],["MT","ğŸ‡²ğŸ‡¹"],["MX","ğŸ‡²ğŸ‡½"],["MY","ğŸ‡²ğŸ‡¾"],["NG","ğŸ‡³ğŸ‡¬"],
  ["NL","ğŸ‡³ğŸ‡±"],["NO","ğŸ‡³ğŸ‡´"],["NP","ğŸ‡³ğŸ‡µ"],["NZ","ğŸ‡³ğŸ‡¿"],["OM","ğŸ‡´ğŸ‡²"],["PA","ğŸ‡µğŸ‡¦"],["PE","ğŸ‡µğŸ‡ª"],["PH","ğŸ‡µğŸ‡­"],
  ["PK","ğŸ‡µğŸ‡°"],["PL","ğŸ‡µğŸ‡±"],["PR","ğŸ‡µğŸ‡·"],["PT","ğŸ‡µğŸ‡¹"],["PY","ğŸ‡µğŸ‡¾"],["QA","ğŸ‡¶ğŸ‡¦"],["RO","ğŸ‡·ğŸ‡´"],["RS","ğŸ‡·ğŸ‡¸"],
  ["RU","ğŸ‡·ğŸ‡º"],["SA","ğŸ‡¸ğŸ‡¦"],["SE","ğŸ‡¸ğŸ‡ª"],["SG","ğŸ‡¸ğŸ‡¬"],["SI","ğŸ‡¸ğŸ‡®"],["SK","ğŸ‡¸ğŸ‡°"],["TH","ğŸ‡¹ğŸ‡­"],["TJ","ğŸ‡¹ğŸ‡¯"],
  ["TM","ğŸ‡¹ğŸ‡²"],["TN","ğŸ‡¹ğŸ‡³"],["TR","ğŸ‡¹ğŸ‡·"],["TW","ğŸ‡¹ğŸ‡¼"],["UA","ğŸ‡ºğŸ‡¦"],["UK","ğŸ‡¬ğŸ‡§"],["US","ğŸ‡ºğŸ‡¸"],["UY","ğŸ‡ºğŸ‡¾"],
  ["UZ","ğŸ‡ºğŸ‡¿"],["VE","ğŸ‡»ğŸ‡ª"],["VN","ğŸ‡»ğŸ‡³"],["ZA","ğŸ‡¿ğŸ‡¦"]
]);

try {
  var obj = JSON.parse($response.body);

  var flag = flags.get(obj.country_code) || "ğŸ³ï¸";
  var org = obj.as_name || obj.org || "Unknown";
  var country = obj.country || "Unknown";
  var continent = obj.continent || "";
  var asn = obj.asn || "";
  var ip = obj.ip || "";

  var title = flag + " " + country;
  var subtitle = org;
  var description = country + (continent ? " | " + continent : "") + "\n" + (asn ? asn + " - " : "") + org + "\nIP: " + ip;

  $done({title: title, subtitle: subtitle, ip: ip, description: description});
} catch (e) {
  $done({title: "âŒ Error", subtitle: e.message, ip: "", description: "Script error: " + e.message + "\nResponse: " + $response.body});
}
